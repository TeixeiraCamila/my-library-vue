import{u as p,e as w,c as i,o as l,f as k,g as m,h as x,r as f,a as _,_ as $,i as v,b,j as y,t as d,n as B,F as C,d as E,k as z}from"./index-BwdD-lw7.js";const j=()=>({formatDate:o=>o?new Date(o).toLocaleDateString("pt-BR"):""}),D={class:"book-actions flex items-center gap-2"},L={__name:"ActionsButtons",props:{book:Object},setup(e){const{openForEdit:o}=x(),r=p(),n=w();function u(t){if(!r.canEdit){alert("VocÃª nÃ£o tem permissÃ£o para editar livros");return}o(t)}function a(t){n.deleteBook(t),confirm("Tem certeza que deseja deletar?")}return(t,s)=>(l(),i("div",D,[m(r).canEdit?(l(),i("button",{key:0,class:"btn-secundary",onClick:s[0]||(s[0]=c=>u(e.book))}," âœï¸ Editar ")):k("",!0),m(r).canDelete?(l(),i("button",{key:1,class:"btn-secundary",onClick:s[1]||(s[1]=c=>a(e.book.book_id))}," ðŸ—‘ï¸ Deletar ")):k("",!0)]))}};function S(){const e=f(!1),o=f(null);async function r(a){if(!a)return null;e.value=!0,o.value=null;try{const s=await(await fetch(`https://www.googleapis.com/books/v1/volumes?q=isbn:${a}`)).json();if(s.items&&s.items.length>0){const c=s.items[0].volumeInfo;return{thumbnail:c.imageLinks?.thumbnail||null,smallThumbnail:c.imageLinks?.smallThumbnail||null,large:c.imageLinks?.thumbnail?.replace("zoom=1","zoom=0")||null}}return null}catch(t){return o.value=t.message,console.error("âŒ Erro ao buscar capa:",t),null}finally{e.value=!1}}async function n(a,t){if(!a)return null;e.value=!0,o.value=null;try{const s=t?`${a}+inauthor:${t}`:a,h=await(await fetch(`https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(s)}`)).json();if(h.items&&h.items.length>0){const g=h.items[0].volumeInfo;return{thumbnail:g.imageLinks?.thumbnail||null,smallThumbnail:g.imageLinks?.smallThumbnail||null,large:g.imageLinks?.thumbnail?.replace("zoom=1","zoom=0")||null}}return null}catch(s){return o.value=s.message,console.error("âŒ Erro ao buscar capa:",s),null}finally{e.value=!1}}async function u(a){if(a.isbn13){const t=await r(a.isbn13);if(t)return t}if(a.isbn){const t=await r(a.isbn);if(t)return t}return await n(a.title,a.author)}return{loading:e,error:o,fetchCover:u,fetchCoverByISBN:r,fetchCoverByTitleAuthor:n}}const I={class:"book-card"},T=["src","alt"],q=["alt"],M={__name:"BookCover",props:{book:{type:Object,required:!0},size:{type:String,default:"medium",validator:e=>["small","medium","large"].includes(e)}},setup(e){const o=e,{fetchCover:r}=S(),n=f(null),u=f(!1),a=async()=>{if(!o.book||n.value)return;if(o.book.cover_url){n.value=o.book.cover_url;return}const t=await r({isbn13:o.book.isbn13,isbn:o.book.isbn,title:o.book.title,author:o.book.author});t&&(o.size==="large"?n.value=t.large||t.thumbnail:o.size==="small"?n.value=t.smallThumbnail||t.thumbnail:n.value=t.thumbnail)};return _(async()=>{a()}),(t,s)=>(l(),i("div",I,[n.value&&!u.value?(l(),i("img",{key:0,src:n.value,alt:`Capa de ${e.book.title}`,class:"w-28 h-auto rounded-md shadow-md",onError:s[0]||(s[0]=(...c)=>t.handleImageError&&t.handleImageError(...c))},null,40,T)):(l(),i("img",{key:1,src:"https://placehold.co/80x120",alt:`Capa do livro ${e.book.title}`,class:"w-28 h-auto rounded-md shadow-md"},null,8,q))]))}},N=["id"],V=["title"],A={class:"book-content flex flex-col items-center gap-2"},O={class:"book-info"},F={class:"text-lg font-semibold text-center"},R={class:"text-sm text-gray-600 text-center"},U={class:"book-rating flex flex-col items-center gap-2"},G={key:0},P={key:1,class:"text-xs text-gray-500"},H={__name:"BookCard",props:{book:Object},setup(e){const o=e,{formatDate:r}=j(),n=v(()=>{const a=o.book.reading_status?.toLowerCase();return a?a==="to-read"||a==="tbr"?"to-read":a:""}),u=v(()=>{const a=n.value;return{read:"âœ…","currently-reading":"ðŸ“–","to-read":"ðŸ“š",abandonado:"âŒ"}[a]||" "});return(a,t)=>(l(),i("div",{class:B(["book-card w-full sm:w-1/2 md:w-1/3 lg:w-1/4 xl:w-1/5 bg-white p-4 shadow-lg rounded-lg flex flex-col",`shelf-${e.book.reading_status}`]),id:e.book.book_id},[e.book.reading_status?(l(),i("div",{key:0,class:"book-shelf-badge absolute top-2 left-2 bg-white text-xs px-2 py-1 rounded-xl shadow-md",title:`Prateleira: ${e.book.reading_status}`},d(u.value),9,V)):k("",!0),b("div",A,[y(M,{book:e.book,size:a.medium},null,8,["book","size"]),b("div",O,[b("h2",F,d(e.book.title),1),b("p",R,"by "+d(e.book.author),1)]),b("div",U,[e.book.my_rating&&e.book.my_rating!=="0"?(l(),i("span",G,d("â­".repeat(Math.round(e.book.my_rating))),1)):k("",!0),e.book.finish_date?(l(),i("span",P," ðŸ“… "+d(m(r)(e.book.start_date))+" - "+d(m(r)(e.book.finish_date)),1)):k("",!0)])]),y(L,{book:e.book},null,8,["book"])],10,N))}},J=$(H,[["__scopeId","data-v-0aa0a677"]]),K={key:0,class:"h-100"},Q={key:1,class:"books-list flex flex-wrap justify-between gap-8"},X={__name:"BooksListView",setup(e){const o=w();return _(async()=>{await o.fetchBooks(),await o.fetchBookshelves()}),(r,n)=>m(o).loading?(l(),i("div",K," LOADING ")):(l(),i("div",Q,[(l(!0),i(C,null,E(m(o).books,u=>(l(),z(J,{key:`${u.book_id} - ${u.title}`,book:u},null,8,["book"]))),128))]))}};export{X as default};
